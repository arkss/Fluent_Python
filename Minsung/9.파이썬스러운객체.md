# 9. 파이썬스러운 객체

## 9.1 객체 표현

```python
repr() # 객체를 개발자가 보고자 하는 형태로 표현한 문자열로 반환한다. 		
str() # 객체를 사용자가 보고자 하는 형태로 표현한 문자열로 반환한다.
```

`repr()`과 `str()` 메서드를 지원하려면 `__repr__()` 와 `__str__()` 특별 메서드를 구현해야 합니다. 

객체를 표현하는 다른 방법을 지원하는 `__bytes__()` 와 `__format__()` 두 개의 특별 메서드도 있습니다.

  `__bytes__()` 는 `bytes()` 메서드에 의해 호출되며 객체를 바이트 시퀀스로 표현합니다.

`__format__()`은 `format()` 과 `str.format()` 메서드 둘 다 사용가능하며 특별 포멧 코드를 이용해서 객체를 표현하는 문자열을 반환합니다.







## 9.2 벡터 클래스의 부활

여러 메서드의 예를 알아보기 위해 벡터 클래스를 에시로 사용하겠습니다.

``` python
from array import array
import math


class Vector2d:
    typecode = 'd'

    def __init__(self, x, y):
        self.x = float(x)
        self.y = float(y)

    def __iter__(self):
        return (i for i in (self.x, self.y))

    def __repr__(self):
        class_name = type(self).__name__
        return '{}({!r}, {!r})'.format(class_name, *self)

    def __str__(self):
        return str(tuple(self))

    def __bytes__(self):
        return (bytes([ord(self.typecode)]) + bytes(array(self.typecode, self)))

    def __eq__(self):
        return tuple(self) == tuple(other)

    def __abs__(self):
        return math.hypot(self.x, self.y)

    def __bool__(self):
        return bool(abs(self))

```



이에 대해 몇 가지 테스트 해본 결과는 다음과 같습니다.

``` python
v1 = Vector2d(3, 4)
print(v1)
# (3.0, 4.0)
print(bytes(v1))
# b'd\x00\x00\x00\x00\x00\x00\x08@\x00\x00\x00\x00\x00\x00\x10@'
print(bool(v1))
# True
```







## 9.3 대안 생성자

Vector2d를 bytes로 변환하는 메서드가 있으니 당연히 bytes를 Vector2d로 변환하는 메서드도 있어야 합니다.

이를 추가해봅시다.

``` python
@classmethod
def frombytes(cls, octets):
    typecode = chr(octets[0])
    memv = memoryview(octets[1:]).cast(typecode)
    return cls(*memv)
```





## 9.4 @classmethod와 @staticmethod

`@classmethod` 는 객체가 아닌 클래스에 연산을 수행하는 메서드를 정의합니다.

클래스 자체를 첫번째 인수로 받으며 관습적으로 `cls` 를 많이 사용합니다.



`@staticmethod` 는 메서드가 특별한 첫 번째 인수를 받지 않도록 메서드를 변경합니다.

본질적으로 정적 메서드는 모듈 대신 클래스 본체 안에 정의된 평벙함 함수입니다.



두 데커레이터의 동작을 비교해봅시다.

``` python
class Demo:
    @classmethod
    def classmeth(*args):
        return args

    @staticmethod
    def staticmeth(*args):
        return args

print(Demo.classmeth())
print(Demo.classmeth('demo'))
# (<class '__main__.Demo'>,)
# (<class '__main__.Demo'>, 'demo')


print(Demo.staticmeth())
print(Demo.staticmeth('demo'))
# ()
# ('demo',)
```







## 9.5 포맷된 출력

`format()` 내장 함수와 `str.format()` 메서드는 실제 포맷 작업을 `__format__(format_spec)` 메서드에 위임합니다. 

format_spec은 포맷 명시자로서 다음 두 가지 방법 중 하나를 통해 지정합니다.

* format(my_obj, format_spec) 의 두 번째 인수
* str.format()에 사용된 포맷 문자열 안에 {}로 구분한 대체 필드 안에서 콘론 뒤의 문자열

```python
br1 = 1/2.43
print(br1)
# 0.4115226337448559
print(format(br1, '0.4f'))
# 0.4115
print('1 BRL = {rate:0.2f} USD'.format(rate=br1))
# 1 BRL = 0.41 USD
```



