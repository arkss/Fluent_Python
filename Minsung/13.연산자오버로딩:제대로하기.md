# 13. 연산자 오버로딩: 제대로 하기

이 장에서는 아래와 같은 내용을 설명하겠습니다.

* 파이썬이 다른 자료형의 피연산자로 중위 연산자를 지원하는 방법
* 다양한 자료형의 피연산자를 다루기 위한 덕 타이핑이나 명시적인 자료형 검사의 사용
* ==, >, <= 등 향상된 비교 연산자의 별난 행동
* 피연산자를 처리할 수 없다고 중위 연산자 메서드가 알려주는 방법
* +=과 같은 계산 할당 연산자의 기본 처리 방식 및 오버로딩 방법



## 13.1 연산자 오버로딩 기본 지식

연산자 오버로딩을 잘못하게 되면 버그를 만들거나 예상치 못한 성능상의 병목이 될 수 있습니다.

그렇지만 잘 사용하면 코드의 가독성이 향상되고 만족스러운 API를 구현할 수 있습니다.

파이썬은 다음과 같은 제한을 두어 융통성, 사용성, 안전성을 적절히 유지합니다.

* 내장 자료형에 대한 연산자는 오버로딩할 수 없다.
* 새로운 연산자를 생성할 수 없으며, 기존 연산자를 오버로딩만 할 수 있다.
* is, and, or, not 연산자는 오버로딩할 수 없다. (&, |, ~ 비트 연산자는 가능하다.)



### 13.2 단항 연산자

세 개의 단항 연산자와 그와 관련된 특별 메서드는 다음과 같습니다.

`-` : \__neg__

​	x가 2면 -x는 -2

`+` : \__pos__

​	일반적으로 x와 +x 는 동일하지만 그렇지 않은 경우도 있습니다. 이에 대해선 뒤에서 자세하게 살펴보겠습니다.

`~` : \__invert__ 

​	정수형의 비트 반전으로 ~x는 -(x+1)로 정의됩니다.



단항연산자를 구현하기 위해서는 self 인수 하나를 받는 적절한 특별 메서드를 구현하면 됩니다. 

이 때 self를 직접 수정하는 것이 아닌 적절한 자료형의 객체를 새로 생성해서 반환해야합니다.

`+` : \__pos__의 경우 일반적으로 self의 사본을 반환하는 것이 좋습니다.



앞선 chapter에서 살펴봤던 Vector에서 단항 연사자를 추가해보겠습니다.

```python
def __abs__(self):
    return math.sqrt(sum(x*x for x in self))

def __neg__(self):
    return Vector(-x for x in self)

def __pos__(self):
    return Vector(self)
```

