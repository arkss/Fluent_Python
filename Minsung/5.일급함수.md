# 일급 함수

파이썬의 함수는 일급 객체입니다. 

프로그래밍 언어 이론가들은 다음과 같은 작업을 수행할 수 있는 프로그램 개체를 '일급 객체'로 정의합니다.

* 런타임에 생성할 수 있다.
* 데이터 구조체의 변수나 요소에 할당할 수 있다.
* 함수 인수로 전달할 수 있다.
* 함수 결과로 변환할 수 있다.

정수, 문자열, 딕셔너리도 파이썬의 일급 객체입니다. 

> 해당 챕터의 제목 `일급 함수` 는 일급 객체로서의 함수를 줄여서 말한 용어입니다.



## 5.1 함수를 객체처럼 다루기

아래 예제를 통해 파이썬 함수가 객체임을 확인할 수 있습니다.

함수를 생성하고, 호출하고, `__doc__` 속성을 읽고 함수 객체 자체가 function 클래스의 객체인지 확인합니다.

```python
def factorial(n):
    '''returns n!'''
    return 1 if n < 2 else n*factorial(n-1)


print(factorial(5))
print(factorial.__doc__)
print(type(factorial))
"""
120
returns n!
<class 'function'>
"""
```



추가적으로 다음과 같이 다른 변수에 할당하고 map()의 인수로 전달할 수도 있습니다.

``` python
def factorial(n):
    '''returns n!'''
    return 1 if n < 2 else n*factorial(n-1)

fact = factorial

print(fact)
print(fact(5))
print(list(map(factorial, range(5))))
"""
<function factorial at 0x10852ef80>
120
[1, 1, 2, 6, 24]
"""
```





## 5.2 고위 함수

함수를 인수로 받거나, 함수를 결과로 반환하는 함수를 `고위 함수`, 영어로는 higher-order function 이라고 합니다.

위에서 봤던 map(), sort(), sorted() 등의 함수가 있습니다.



### 5.2.1 map(), filter(), reduce()의 대안

이름이 다른 경우도 있지만, 함수형 언어는 모두 map(), filter(), reduce() 고위 함수를 제공합니다. 

python3의 경우, map()과 filter() 함수가 있지만 지능형 리스트와 제너레이터 표현식이 소개된 이후 해당 함수들의 중요성이 떨어졌습니다.

``` python
def fact(n):
    '''returns n!'''
    return 1 if n < 2 else n*fact(n-1)


map_fact = list(map(fact, range(5)))
compre_fact = [fact(n) for n in range(5)]

print(map_fact)    # [1, 1, 2, 6, 24]  
print(compre_fact) # [1, 1, 2, 6, 24]

filter_fact = list(map(fact, filter(lambda n: n % 2, range(5))))
compre_fact2 = [fact(n) for n in range(5) if n % 2]

print(filter_fact)  # [1, 6]
print(compre_fact2) # [1, 6]
```



python2까지 내장함수였던 reduce는 python3부터 functools모듈로 분리되었습니다.

reduce()은 주로 합계를 구하기 위해 사용되는데 reduce()보다는 sum()을 사용하는 것이 가독성과 성능 면에서 훨씬 낫습니다.

``` python
import time
from functools import reduce
from operator import add

start = time.time()
reduce(add, range(10000000))
end = time.time()
print(end - start)
# 0.7389461994171143

start = time.time()
sum(range(10000000))
end = time.time()
print(end - start)
# 0.2219069004058838
```





## 5.3 익명 함수

lambda 키워드는 파이썬 표현식 내에 익명 함수를 생성합니다.

그렇지만 파이썬의 단순한 구문이 람다 함수의 본체가 순수한 표현식으로만 구성되도록 제한합니다.

즉 람다 본체에서는 할당문이나 while, try 등의 파이썬 문장을 사용할 수 없습니다.

고위 함수의 인수로 사용하는 방법 외에 익명함수는 파이썬에서 거의 사용되지 않습니다.

가독성이 떨어지고 사용하기 까다롭다는 점 때문이죠.

철자 역순으로 단어 리스트 정렬하는 예입니다.

```python
fruits = ['strawberry', 'fig', 'apple', 'cherry', 'raspberry', 'banana']

print(sorted(fruits, key=lambda word: word[::-1]))
# ['banana', 'apple', 'fig', 'raspberry', 'strawberry', 'cherry']
```





## 5.4 일곱 가지 맛의 콜러블 객체

호출 연산자인 `()` 는 사용자 정의 함수 이외의 다른 객체에도 적용할 수 있습니다. 호출할 수 있는 객체인지 알아보려면 `callable()` 내장 함수를 사용합니다.

다음은 파이썬 데이터 모델 문서에 나오는 일곱 가지 콜러블입니다.

* 사용자 정의 함수 : def문이나 람다 표현식으로 생성
* 내장 함수 : len() 이나 time.strftime() 처럼 C언어로 구현된 함수
* 내장 메서드 : dict.get() 처럼 C언어로 구현된 메서드
* 메서드 : 클래스 본체에 정의된 함수
* 클래스 : 호출 될 때 클래스는 자신의 `__new__()` 메서드를 실행해서 객체를 생성하고, `__init__()`으로 초기화 한 후, 최종적으로 호출자에 객체를 반환.
* 클래스 객체 : 클래스가 __call()__ 메서드를 구현하면 이 클래스의 객체는 함수로 호출 가능
* 클래스 객체 : 클래스가 `__call()__` 메서드를 구현하면 이 클래스의 객체는 함수로 호출 가능
* 제너레이터 함수 : yield 키워드를 사용하는 함수나 메서드, 이 함수가 호출되면 제너레이터 객체를 반환





## 5.5 사용자 정의 콜러블형

파이썬 함수가 실제 객체일 뿐만 아니라, 모든 파이썬 객체가 함수처럼 동작하게 만들 수 있습니다.

``` python
import random


class BingoCage:
    def __init__(self, items):
        self._items = list(items)
        random.shuffle(self._items)

    def pick(self):
        try:
            return self._items.pop()
        except IndexError:
            raise LookupError('pick from empty BingoCage')

    def __call__(self):
        return self.pick()


bingo = BingoCage(range(3))
print(bingo.pick())
print(bingo())
```

